<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV M3U Sorter</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modal-top-fix.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/channel-management.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-tv"></i> IPTV M3U Sorter</h1>
            <p>Organisieren Sie Ihre IPTV-Playlisten mit Drag & Drop</p>
        </div>

        <!-- Save Success Info - Fixed at top -->
        <div id="saveSuccessInfo" class="success-banner" style="display: none;">
            <div class="success-content">
                <div class="success-header">
                    <i class="fas fa-check-circle"></i>
                    <span>Playlist erfolgreich online gespeichert!</span>
                    <button onclick="hideSaveSuccess()" class="close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="url-display">
                    <span>URL:</span>
                    <input type="text" id="savedUrlDisplay" readonly>
                    <button onclick="copyUrl()" class="copy-btn">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <section id="uploadSection">
            <div class="upload-area" id="uploadArea">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>M3U-Datei hochladen</h3>
                <p>Ziehen Sie Ihre M3U-Datei hierher oder klicken Sie zum Durchsuchen</p>
                <input type="file" id="fileInput" accept=".m3u" style="display: none;">
                <button onclick="document.getElementById('fileInput').click()" class="btn btn-primary">
                    <i class="fas fa-file-upload"></i> Datei auswählen
                </button>
            </div>
        </section>

        <!-- Loading Section -->
        <section id="loadingSection" style="display: none;">
            <div class="loading-container">
                <div class="spinner"></div>
                <h3>Verarbeitung läuft...</h3>
                <p>Ihre M3U-Datei wird analysiert und die Kanäle werden geladen.</p>
            </div>
        </section>

        <!-- Playlist Section -->
        <section id="playlistSection" style="display: none;">
            <div class="playlist-info">
                <div class="stats">
                    <div class="stat-item">
                        <span id="totalChannels">0 Kanäle</span>
                    </div>
                    <div class="stat-item">
                        <span id="totalGroups">0 Gruppen</span>
                    </div>
                </div>
                
                <div class="playlist-actions">
                    <button onclick="exportPlaylist()" class="btn btn-download">
                        <i class="fas fa-download"></i> DOWNLOAD
                    </button>
                    <button onclick="savePlaylist()" class="btn btn-save">
                        <i class="fas fa-save"></i> SAVE ONLINE
                    </button>
                    <button onclick="resetPlaylist()" class="btn btn-upload">
                        <i class="fas fa-upload"></i> UPLOAD NEW
                    </button>
                </div>

                <!-- Channel Management Actions -->
                <div class="channel-actions" id="channelActions" style="display: none;">
                    <div class="selection-info">
                        <button onclick="window.channelManager && window.channelManager.enableSelectMode()" class="btn btn-secondary" id="enableDeleteBtn">
                            <i class="fas fa-trash"></i> Lösch-Modus
                        </button>
                        <span id="selectedCount">0 ausgewählt</span>
                        <button onclick="window.channelManager && window.channelManager.toggleSelectAll()" class="btn btn-select-all" id="selectAllBtn" style="display: none;">
                            <i class="fas fa-check-square"></i> Alle auswählen
                        </button>
                    </div>
                    <div class="action-buttons" style="display: none;" id="deleteActions">
                        <button onclick="window.channelManager && window.channelManager.deleteSelectedChannels()" class="btn btn-delete" id="deleteBtn" disabled>
                            <i class="fas fa-trash"></i> Ausgewählte löschen
                        </button>
                        <button onclick="window.channelManager && window.channelManager.disableSelectMode()" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Abbrechen
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sortierungs-Vorlagen nach oben verschoben -->
            <div class="template-section">
                <h3><i class="fas fa-clipboard-list"></i> Sortierungs-Vorlagen</h3>
                  <div class="template-row">

                    <select id="templateSelector" class="template-selector">
                        <option value="">Vorlage auswählen...</option>
                    </select>
                    <button onclick="saveCurrentTemplate()" class="btn btn-primary">
                        <i class="fas fa-save"></i> Aktuelle Vorlage speichern
                    </button>
                    <button onclick="applyTemplate()" class="btn btn-success">
                        <i class="fas fa-play"></i> Vorlage anwenden
                    </button>
                    <button onclick="deleteTemplate()" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Vorlage löschen
                    </button>
                    <button onclick="downloadTemplate()" class="btn btn-info">
                        <i class="fas fa-download"></i> Vorlage herunterladen
                    </button>
                  </div>
                  <div class="template-row-bottom">
                    <button onclick="createTemplate()" class="btn btn-secondary">
                        <i class="fas fa-plus"></i> Aktuelle Sortierung als Vorlage speichern
                    </button>
                    <button onclick="uploadTemplate()" class="btn btn-warning">
                        <i class="fas fa-upload"></i> Vorlage hochladen
                    </button>
                  </div>



            </div>

            <div class="search-controls">
                <input type="text" id="searchInput" placeholder="Kanäle suchen...">
                <select id="categoryFilter">
                    <option value="">Alle Kategorien</option>
                </select>
                <button onclick="clearFilters()" class="btn-clear">Filter löschen</button>
            </div>

            <div class="channels-container">
                <div id="channelsList"></div>
            </div>
        </section>

    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/channel-management.js') }}"></script>
    <script>
        // Initialize Channel Manager after DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize channel manager when M3USorter is available
            function initChannelManager() {
                if (typeof window.sorter !== 'undefined') {
                    window.channelManager = new ChannelManager(window.sorter);
                    console.log('Channel Manager initialized');
                } else {
                    setTimeout(initChannelManager, 100);
                }
            }
            initChannelManager();
        });
    </script>
</body>
</html>
